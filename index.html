<html>
  <head>
    <title>AR.js Basic Projected Camera Example</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!-- Look-at component. We don't need this now, but we will later. -->
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./styles.css" />
  </head>
  <body style="margin: 0; overflow: hidden">
    <div id="info" class="centered info"></div>

    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;"
    >
      <!-- <a-sphere gps-projected-entity-place="latitude:  33.063034; longitude:-16.354469" material="color: white" scale="3 3 3"></a-sphere>
      <a-sphere gps-projected-entity-place="latitude:33.06285; longitude:-16.3542" material="color: blue" scale="3 3 3"></a-sphere> -->
      <a-plane position="0 0 4" rotation="-90 0 0" width="10" height="40" color="#7BC8A4"></a-plane>

      <a-camera gps-projected-camera rotation-reader></a-camera>
    </a-scene>
  </body>

  <script>
    let lat = 33.063034
    let lng = -16.354469

    navigator.geolocation.getCurrentPosition(function success(position) {
      lat = position.coords.latitude
      lng = position.coords.longitude
      let sceneEl = document.querySelector('a-scene')

      // Calculate new lat and lng
      // new_latitude = latitude + (dy / r_earth) * (180 / pi)
      // new_longitude = longitude + ((dx / r_earth) * (180 / pi)) / cos((latitude * pi) / 180)

      let newLat = lat + (-0.0009 / 111) * (180 / 3.14159265)
      let newLng = lng + ((-0.0009 / 111) * (180 / 3.14159265)) / Math.cos((lat * 3.14159265) / 180)

      let markerEl = document.createElement('a-link')
      markerEl.setAttribute('color', 'red')
      markerEl.setAttribute('title', 'Ponto 1')
      markerEl.setAttribute('scale', '3 3 3')
      markerEl.addEventListener('loaded', () => {
        window.dispatchEvent(new CustomEvent('gps-entity-place-loaded'))
      })

      markerEl.setAttribute('gps-projected-entity-place', `latitude: ${newLat};longitude: ${newLng}`)
      // console.log('coords:', `lat: ${lat}; lng:${lng}`)
      // console.log('new coords:', `lat: ${newLat}; lng:${newLng}`)
      sceneEl.appendChild(markerEl)

      let instructionsEl = document.getElementById('info')
      instructionsEl.innerHTML = `lat: ${newLat.toFixed(4)}; lng:${newLng.toFixed(4)}`
    })
  </script>
</html>
